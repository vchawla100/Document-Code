import com.itextpdf.text.Document;
import com.itextpdf.text.DocumentException;
import com.itextpdf.text.PageSize;
import com.itextpdf.text.pdf.PdfWriter;
import com.itextpdf.tool.xml.XMLWorker;
import com.itextpdf.tool.xml.XMLWorkerFontProvider;
import com.itextpdf.tool.xml.XMLWorkerHelper;
import com.itextpdf.tool.xml.css.CssFile;
import com.itextpdf.tool.xml.css.CssFileImpl;
import com.itextpdf.tool.xml.css.StyleAttrCSSResolver;
import com.itextpdf.tool.xml.html.Tags;
import com.itextpdf.tool.xml.pipeline.css.CSSResolverPipeline;
import com.itextpdf.tool.xml.pipeline.end.PdfWriterPipeline;
import com.itextpdf.tool.xml.pipeline.html.HtmlPipeline;
import com.itextpdf.tool.xml.pipeline.html.HtmlPipelineContext;

import java.io.FileOutputStream;
import java.io.IOException;
import java.io.StringReader;

public class HtmlToPdfWithCss {
    public static void main(String[] args) {
        Document document = new Document(PageSize.A4);
        try {
            PdfWriter writer = PdfWriter.getInstance(document, new FileOutputStream("output.pdf"));
            document.open();
            
            // Define your CSS
            String css = "p { color: blue; font-size: 16px; }"
                       + "p.yellow-background { background-color: yellow; }";

            // Create CSS file
            CssFile cssFile = new CssFileImpl();
            cssFile.getCssRules().add(css);

            // Setup CSS resolver
            StyleAttrCSSResolver cssResolver = new StyleAttrCSSResolver();
            cssResolver.addCss(cssFile);

            // Setup HTML context
            HtmlPipelineContext htmlContext = new HtmlPipelineContext(null);
            htmlContext.setTagFactory(Tags.getHtmlTagProcessorFactory());

            // Setup pipeline
            CSSResolverPipeline cssPipeline = new CSSResolverPipeline(cssResolver, new HtmlPipeline(htmlContext, new PdfWriterPipeline(document, writer)));
            XMLWorker worker = new XMLWorker(cssPipeline, true);
            XMLWorkerHelper.getInstance().parseXHtml(worker, document, new StringReader(htmlContent));
        } catch (DocumentException | IOException e) {
            e.printStackTrace();
        } finally {
            document.close();
        }
    }
}
